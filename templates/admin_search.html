{% extends 'base.html' %}
{% block title %}Admin Search - Hospital Management System{% endblock %}
{% block content %}
<div class="page-header">
  <h3><i class="bi bi-search me-2"></i>Admin Search</h3>
  <p class="text-muted mb-0">Search and manage users in the system</p>
</div>

<div class="content-area mb-4">
  <form class="row g-3">
    <div class="col-md-3">
      <label class="form-label">Search Type</label>
      <select class="form-select" name="type">
        <option value="patient" {% if type_=='patient' %}selected{% endif %}>Patients</option>
        <option value="doctor" {% if type_=='doctor' %}selected{% endif %}>Doctors</option>
      </select>
    </div>
    <div class="col-md-6">
      <label class="form-label">Search Query</label>
      <input name="q" value="{{ q }}" class="form-control" placeholder="Search by name, username, or ID">
    </div>
    <div class="col-md-3 d-flex align-items-end">
      <button class="btn btn-primary w-100">
        <i class="bi bi-search me-2"></i>Search
      </button>
    </div>
  </form>
</div>

{% if type_=='patient' %}
  <div class="content-area">
    <h5 class="mb-3">
      <i class="bi bi-people me-2"></i>Patient Results
    </h5>
    {% if results %}
      <div class="list-group">
        {% for p in results %}
          <div class="list-group-item d-flex justify-content-between align-items-start">
            <div class="ms-2 me-auto">
              <div class="fw-bold">{{ p.user.full_name }}</div>
              <small class="text-muted">ID: {{ p.id }} | Username: {{ p.user.username }}</small>
            </div>
            <form method="post" action="{{ url_for('admin_toggle_active', user_id=p.user.id) }}" class="d-inline">
              <button class="btn btn-sm {{ 'btn-outline-danger' if p.user.active else 'btn-outline-success' }}">
                <i class="bi bi-{{ 'person-x' if p.user.active else 'person-check' }} me-1"></i>
                {{ 'Deactivate' if p.user.active else 'Activate' }}
              </button>
            </form>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="text-center py-4">
        <i class="bi bi-search text-muted" style="font-size: 3rem;"></i>
        <p class="text-muted mt-2 mb-0">No patients found</p>
      </div>
    {% endif %}
  </div>
{% else %}
  <div class="content-area">
    <h5 class="mb-3">
      <i class="bi bi-person-badge me-2"></i>Doctor Results
    </h5>
    {% if results %}
      <div class="list-group">
        {% for d in results %}
          <div class="list-group-item d-flex justify-content-between align-items-start">
            <div class="ms-2 me-auto">
              <div class="fw-bold">{{ d.user.full_name }}</div>
              <small class="text-muted">ID: {{ d.id }} | Username: {{ d.user.username }} | Specialization: {{ d.specialization }}</small>
            </div>
            <form method="post" action="{{ url_for('admin_toggle_active', user_id=d.user.id) }}" class="d-inline">
              <button class="btn btn-sm {{ 'btn-outline-danger' if d.user.active else 'btn-outline-success' }}">
                <i class="bi bi-{{ 'person-x' if d.user.active else 'person-check' }} me-1"></i>
                {{ 'Deactivate' if d.user.active else 'Activate' }}
              </button>
            </form>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="text-center py-4">
        <i class="bi bi-search text-muted" style="font-size: 3rem;"></i>
        <p class="text-muted mt-2 mb-0">No doctors found</p>
      </div>
    {% endif %}
  </div>
{% endif %}
{% endblock %}
