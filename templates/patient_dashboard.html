{% extends 'base.html' %}
{% block content %}
<h4>Patient Dashboard</h4>

<h5>Search Doctors</h5>
<form class="row g-2 mb-3" action="{{ url_for('search_doctors') }}">
  <div class="col-md-4"><input name="q" class="form-control" placeholder="Name or username"></div>
  <div class="col-md-4"><input name="dept" class="form-control" placeholder="Specialization or department"></div>
  <div class="col-md-2"><button class="btn btn-primary">Search</button></div>
</form>

<h5>All Doctors</h5>
<div class="row">
  {% for d in doctors %}
    <div class="col-md-4">
      <div class="card p-2 mb-2">
        <h6>{{ d.user.full_name }} <small class="text-muted">({{ d.specialization }})</small></h6>
        <p class="small">{{ d.department.name if d.department else '' }}</p>
        <a class="btn btn-sm btn-outline-primary" href="{{ url_for('doctor_profile', doctor_id=d.id) }}">View & Book</a>
      </div>
    </div>
  {% endfor %}
</div>

<h5 class="mt-4">Your Appointments</h5>
<table class="table table-sm">
  <tr><th>ID</th><th>Doctor</th><th>Date</th><th>Time</th><th>Status</th><th>Action</th></tr>
  {% for a in appointments %}
    <tr>
      <td>{{ a.id }}</td>
      <td>{{ a.doctor.user.full_name }}</td>
      <td>{{ a.date }}</td>
      <td>{{ a.time }}</td>
      <td>{{ a.status }}</td>
      <td>
        {% if a.status != 'Cancelled' %}
        <form method="post" action="{{ url_for('cancel_appointment', appt_id=a.id) }}">
          <button class="btn btn-sm btn-danger">Cancel</button>
        </form>
        {% endif %}
      </td>
    </tr>
  {% endfor %}
</table>
{% endblock %}
